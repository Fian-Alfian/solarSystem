<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Solar System AR Generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <script>
      // Komponen A-Frame untuk menangani pemutaran suara berdasarkan visibilitas penanda AR.
      AFRAME.registerComponent('soundhandler', {
        init: function () {
          // Dapatkan entitas suara menggunakan ID-nya.
          this.soundEl = document.querySelector('#universeAudio');
          // Elemen penanda itu sendiri adalah 'el' dari komponen ini.
          this.marker = this.el;
          this.isPlaying = false; // Bendera untuk melacak apakah suara sedang diputar

          // Tambahkan pendengar acara untuk saat penanda AR ditemukan.
          this.el.addEventListener('markerFound', () => {
            // Periksa apakah elemen suara dan komponennya ada, dan jika suara belum diputar.
            if (this.soundEl && this.soundEl.components.sound && !this.isPlaying) {
              this.soundEl.components.sound.playSound(); // Putar suara.
              this.isPlaying = true; // Atur bendera ke true.
              console.log('Penanda ditemukan, memutar suara.');
            }
          });

          // Tambahkan pendengar acara untuk saat penanda AR hilang.
          this.el.addEventListener('markerLost', () => {
            // Periksa apakah elemen suara dan komponennya ada, dan jika suara sedang diputar.
            if (this.soundEl && this.soundEl.components.sound && this.isPlaying) {
              this.soundEl.components.sound.pauseSound(); // Jeda suara saat penanda hilang.
              this.isPlaying = false; // Atur bendera ke false.
              console.log('Penanda hilang, menjeda suara.');
            }
          });
        }
      });

      // Komponen untuk menampilkan pesan kesalahan atau pemuatan.
      AFRAME.registerComponent('message-display', {
        schema: {
          message: {type: 'string', default: ''}
        },
        init: function () {
          this.messageBox = document.createElement('div');
          this.messageBox.classList.add('message-box');
          document.body.appendChild(this.messageBox);
          this.updateMessage(this.data.message);
        },
        update: function () {
          this.updateMessage(this.data.message);
        },
        updateMessage: function (msg) {
          this.messageBox.textContent = msg;
          this.messageBox.style.display = msg ? 'block' : 'none';
        }
      });

      // Fungsi untuk menampilkan pesan di kotak pesan.
      function showMessage(msg) {
        const scene = document.querySelector('a-scene');
        if (scene) {
          scene.setAttribute('message-display', 'message', msg);
        }
      }

      // Fungsi untuk menyembunyikan pesan.
      function hideMessage() {
        showMessage('');
      }

      // Event listener untuk saat scene A-Frame dimuat.
      window.onload = function() {
        const scene = document.querySelector('a-scene');
        if (scene) {
          // Tampilkan pesan pemuatan saat scene mulai dimuat.
          showMessage('Memuat model...');

          // Sembunyikan pesan pemuatan setelah semua aset dimuat.
          scene.addEventListener('loaded', () => {
            hideMessage();
            console.log('Scene dan aset dimuat.');
          });

          // Tangani kesalahan pemuatan aset.
          scene.addEventListener('asset-load-error', (evt) => {
            showMessage(`Kesalahan memuat aset: ${evt.detail.src}`);
            console.error(`Kesalahan memuat aset: ${evt.detail.src}`, evt);
          });
        }
      };
    </script>
    <style>
      /* Gaya dasar untuk body dan instruksi */
      body {
        margin: 0;
        overflow: hidden;
        font-family: 'Inter', sans-serif; /* Menggunakan font Inter */
      }
      .instructions {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(0, 0, 0, 0.6); /* Latar belakang gelap semi-transparan */
        color: white;
        padding: 10px 20px;
        border-radius: 8px; /* Sudut membulat */
        font-size: 16px;
        text-align: center;
        z-index: 100; /* Pastikan berada di atas scene AR */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Bayangan halus */
      }
      .message-box {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(255, 0, 0, 0.7); /* Latar belakang merah semi-transparan untuk kesalahan */
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 18px;
        text-align: center;
        z-index: 101; /* Di atas instruksi */
        display: none; /* Sembunyikan secara default */
      }
    </style>
  </head>
  <body style="margin: 0; overflow: hidden">
    <div class="instructions">
      Arahkan kamera Anda ke penanda AR 'pattern-solar' untuk melihat tata surya!
    </div>

    <a-scene embedded arjs vr-mode-ui="enabled: false" message-display>
      <a-assets>
        <a-asset-item id="earthModel" src="https://cdn.glitch.com/0685718a-9d74-4a14-a915-182379587d60%2Fearth.gltf?v=1605553198895"></a-asset-item>
        <a-asset-item id="solarModel" src="https://cdn.glitch.com/0685718a-9d74-4a14-a915-182379587d60%2Fsun.gltf?v=1605553198895"></a-asset-item>
        <audio id="universeSound" src="assets/audio/universe.mp3" preload="auto"></audio>
      </a-assets>

      <a-marker preset="pattern-solar" soundhandler>
        <a-entity
          gltf-model="#solarModel"
          scale="0.2 0.2 0.2" 
          position="0 0 0" 
          animation="property: rotation; to: 0 360 0; dur: 20000; loop: true; easing: linear;" 
        ></a-entity>

        <a-entity
          position="0 0 0" 
          animation="property: rotation; to: 0 360 0; dur: 36500; loop: true; easing: linear;" 
        >
          <a-entity
            gltf-model="#earthModel"
            scale="0.05 0.05 0.05" 
            position="1 0 0" 
            animation="property: rotation; to: 0 360 0; dur: 5000; loop: true; easing: linear;" 
          ></a-entity>
        </a-entity>
      </a-marker>

      <a-entity id="universeAudio" sound="src: #universeSound; autoplay: false;"></a-entity>

      <a-camera></a-camera>
    </a-scene>
  </body>
</html>
